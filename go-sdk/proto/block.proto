syntax = "proto3";
package mmn;
option go_package = "mmn/proto;proto";
import "tx.proto";

message Entry {
  uint64 num_hashes = 1;
  bytes hash       = 2;
  repeated bytes transactions = 3;
  repeated string tx_hashes = 4;
}

message Block {
  uint64 slot     = 1;
  bytes prev_hash = 2;
  repeated Entry entries = 3;
  string leader_id = 4;
  uint64 timestamp = 5;
  bytes hash = 6;
  bytes signature  = 7;
  repeated TransactionData transaction_data = 8;
}

message EmptyParams {}

message GetBlockByNumberRequest {
  repeated uint64 block_numbers = 1;
}

message GetBlockNumberResponse {
  uint64 block_number = 1;
}

message GetBlockByNumberResponse {
  repeated Block blocks = 1;   
  string error = 3;
  uint32 decimals = 4; // Number of fractional digits for amount formatting
}

message BlockInfo {
  uint64 slot = 1;
  bytes prev_hash = 2;
  string leader_id = 3;
  uint64 timestamp = 4;
  bytes hash = 5;
  bytes signature = 6;
  repeated TransactionData transaction_data = 7; // Only transaction data, no entries
}

message GetBlockByRangeRequest {
  uint64 from_slot = 1;
  uint64 to_slot = 2;
}

message GetBlockByRangeResponse {
  repeated BlockInfo blocks = 1;
  uint32 total_blocks = 2; // Total blocks in the requested range
  repeated string errors = 3;
  uint32 decimals = 4; // Number of fractional digits for amount formatting
}

service BlockService {
  rpc GetBlockNumber(EmptyParams) returns (GetBlockNumberResponse);
  rpc GetBlockByNumber(GetBlockByNumberRequest) returns (GetBlockByNumberResponse);
  rpc GetBlockByRange(GetBlockByRangeRequest) returns (GetBlockByRangeResponse);
}
